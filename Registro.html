<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>RepairOS ‚Äî Registro de licencia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <style>
    :root{
      color-scheme: light;
      --bg:#000000;
      --surface:#ffffff;
      --surface-soft:#f9fafb;
      --border:#e5e7eb;
      --text:#111827;
      --muted:#6b7280;
      --accent:#000000;
      --danger:#b91c1c;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "SF Pro Text", Segoe UI, Roboto, sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 12px;
    }
    .shell{
      width:min(1120px, 100%);
      background:var(--surface);
      border-radius:28px;
      border:1px solid #000;
      padding:1px;
      box-shadow:0 30px 80px rgba(0,0,0,.8);
    }
    .inner{
      border-radius:27px;
      background:var(--surface);
      padding:24px 24px 20px;
      display:grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap:24px;
    }
    @media (max-width:900px){
      .inner{
        grid-template-columns: minmax(0,1fr);
        padding:20px 16px 16px;
      }
    }

    /* Columna izquierda */
    .brand-pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:4px 10px;
      border-radius:999px;
      background:#f3f4f6;
      border:1px solid #111827;
      font-size:11px;
      color:var(--muted);
      margin-bottom:10px;
    }
    .brand-pill-dot{
      width:6px; height:6px;
      border-radius:999px;
      background:#000;
    }
    .logo-text{
      font-size:12px;
      font-weight:600;
      letter-spacing:.08em;
      text-transform:uppercase;
      color:#111827;
    }
    h1{
      margin:4px 0 6px;
      font-size:26px;
      letter-spacing:-.03em;
      color:var(--text);
    }
    .subtitle{
      margin:0 0 12px;
      font-size:13px;
      color:var(--muted);
      max-width:30rem;
    }
    .steps{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:8px;
      margin-bottom:12px;
    }
    .step{
      display:flex;
      gap:8px;
      align-items:flex-start;
      font-size:12px;
      color:#111827;
    }
    .step-icon{
      width:18px;
      height:18px;
      border-radius:999px;
      border:1px solid #000;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:10px;
      background:#fff;
      color:#000;
      flex-shrink:0;
    }
    .step strong{
      font-weight:600;
    }
    .note-box{
      padding:8px 10px;
      border-radius:10px;
      background:#f9fafb;
      border:1px dashed #111827;
      font-size:11px;
      color:#111827;
      max-width:30rem;
    }
    .badge-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:12px;
    }
    .badge,
    .badge-outline{
      padding:3px 8px;
      border-radius:999px;
      font-size:10px;
      white-space:nowrap;
    }
    .badge{
      background:#000;
      color:#f9fafb;
    }
    .badge-outline{
      border:1px solid #111827;
      color:#111827;
      background:#ffffff;
    }

    /* Columna derecha: formulario */
    .card{
      background:var(--surface);
      border-radius:22px;
      border:1px solid var(--border);
      box-shadow:0 16px 40px rgba(0,0,0,.18);
      padding:18px 18px 14px;
      position:relative;
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:8px;
      margin-bottom:8px;
    }
    .card-title{
      font-size:17px;
      margin:0 0 2px;
      color:var(--text);
    }
    .card-desc{
      margin:0;
      font-size:12px;
      color:#6b7280;
    }
    .pill-small{
      font-size:10px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid #111827;
      background:#ffffff;
      color:#111827;
    }
    form{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .section-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.12em;
      color:#6b7280;
      margin:4px 0 2px;
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(210px,1fr));
      gap:8px 12px;
    }
    label{
      font-size:12px;
      color:#111827;
      display:flex;
      flex-direction:column;
      gap:6px;
      position:relative;
    }
    input, select{
      font-size:13px;
      font-family:inherit;
      padding:7px 11px;
      border-radius:999px;
      border:1px solid #111827;
      background:#ffffff;
      color:#111827;
    }
    input::placeholder{
      color:#9ca3af;
    }
    select{
      appearance:none;
      -webkit-appearance:none;
      -moz-appearance:none;
      background-image:linear-gradient(45deg,transparent 50%,#111827 50%),linear-gradient(135deg,#111827 50%,transparent 50%);
      background-position:calc(100% - 14px) 11px,calc(100% - 9px) 11px;
      background-size:5px 5px;
      background-repeat:no-repeat;
    }
    input:focus, select:focus{
      outline:none;
      border-color:#000;
      box-shadow:0 0 0 1px #000;
    }
    .hint{
      font-size:11px;
      color:#6b7280;
      margin:2px 0 0;
    }
    .footer{
      margin-top:8px;
      display:flex;
      justify-content:space-between;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .btn-row{
      display:flex;
      gap:8px;
      margin-left:auto;
    }
    .btn-primary{
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:13px;
      font-weight:500;
      background:#000;
      color:#ffffff;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition:transform .08s ease, box-shadow .08s ease, background .08s ease;
      box-shadow:0 8px 18px rgba(0,0,0,.4);
    }
    .btn-primary:hover{
      background:#111;
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(0,0,0,.55);
    }
    .btn-secondary{
      border-radius:999px;
      padding:8px 14px;
      font-size:12px;
      border:1px solid #111827;
      background:#ffffff;
      color:#111827;
      cursor:pointer;
      transition:background .08s ease, color .08s ease;
    }
    .btn-secondary:hover{
      background:#111827;
      color:#ffffff;
    }
    .btn-primary[disabled]{
      opacity:.7;
      cursor:wait;
      box-shadow:none;
    }
    .status-msg{
      margin-top:6px;
      font-size:11.5px;
      color:#111827;
    }
    .status-error{
      color:var(--danger);
    }

    @media (max-width:900px){
      body{ padding:16px 10px; }
      .card{ box-shadow:0 14px 30px rgba(0,0,0,.25); }
      .footer{ flex-direction:column; align-items:flex-start; }
      .btn-row{ margin-left:0; }
    }

    /* Link t√©rminos */
    .link-terms{
      border:none;
      padding:0;
      margin:0;
      background:none;
      font:inherit;
      color:#111827;
      text-decoration:underline;
      cursor:pointer;
    }
    .link-terms:hover{
      text-decoration:none;
      color:#000;
    }

    /* Checkbox t√©rminos */
    .terms-check{
      display:flex;
      align-items:flex-start;
      gap:6px;
      font-size:11px;
      color:#6b7280;
      max-width:320px;
    }
    .terms-check input{
      margin-top:3px;
      width:14px;
      height:14px;
      border-radius:4px;
      border:1px solid #111827;
      background:#ffffff;
    }
    .terms-check span{
      line-height:1.4;
    }

    /* Modal t√©rminos */
    .terms-overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:80;
      backdrop-filter:blur(6px);
    }
    .terms-modal{
      width:min(760px, 95vw);
      max-height:90vh;
      background:#ffffff;
      border-radius:20px;
      border:1px solid #000;
      box-shadow:0 20px 60px rgba(0,0,0,.8);
      display:flex;
      flex-direction:column;
      color:#111827;
    }
    .terms-header{
      padding:16px 18px 10px;
      border-bottom:1px solid #e5e7eb;
      display:flex;
      justify-content:space-between;
      gap:8px;
    }
    .terms-header h2{
      margin:0 0 4px;
      font-size:17px;
      color:#111827;
    }
    .terms-subtitle{
      margin:0;
      font-size:12px;
      color:#6b7280;
    }
    .terms-close{
      border:none;
      background:none;
      font-size:20px;
      line-height:1;
      cursor:pointer;
      color:#9ca3af;
    }
    .terms-body{
      padding:12px 18px 8px;
      overflow:auto;
    }
    .terms-block + .terms-block{
      margin-top:10px;
    }
    .terms-block h3{
      margin:0 0 4px;
      font-size:13px;
      color:#111827;
    }
    .terms-block p{
      margin:0 0 4px;
      font-size:12px;
      color:#4b5563;
    }
    .terms-block ul{
      margin:0 0 4px 18px;
      padding:0;
    }
    .terms-block li{
      font-size:12px;
      color:#4b5563;
      margin-bottom:2px;
    }
    .terms-note{
      font-size:11px;
      color:#6b7280;
    }
    .terms-footer{
      padding:10px 18px 12px;
      border-top:1px solid #e5e7eb;
      display:flex;
      justify-content:flex-end;
    }

    /* Password toggle */
    .password-wrap{
      position:relative;
      display:flex;
      align-items:center;
    }
    .password-wrap input{
      width:100%;
      padding-right:32px;
    }
    .password-toggle{
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      border:none;
      background:none;
      cursor:pointer;
      font-size:14px;
      color:#6b7280;
    }

    /* WhatsApp tel√©fono con pa√≠s - custom select con banderas */
    .phone-row{
      display:grid;
      grid-template-columns:minmax(0,150px) minmax(0,1fr);
      gap:6px;
      align-items:center;
    }
    .phone-row input[type="tel"]{
      width:100%;
    }
    .country-select{
      position:relative;
      width:100%;
      max-width:150px;
    }
    .country-select-btn{
      width:100%;
      display:flex;
      align-items:center;
      gap:6px;
      justify-content:flex-start;
      border-radius:999px;
      border:1px solid #111827;
      background:#ffffff;
      padding:7px 10px;
      font-size:13px;
      cursor:pointer;
    }
    .country-flag{
      font-size:16px;
    }
    .country-dial{
      font-weight:500;
    }
    .country-name-short{
      font-size:11px;
      color:#6b7280;
    }
    .country-select-dropdown{
      position:absolute;
      top:100%;
      left:0;
      right:0;
      margin-top:6px;
      background:#ffffff;
      border-radius:14px;
      border:1px solid #e5e7eb;
      box-shadow:0 10px 30px rgba(15,23,42,.25);
      z-index:60;
      display:none;
      overflow:hidden;
    }
    .country-search{
      width:100%;
      border:none;
      border-bottom:1px solid #e5e7eb;
      padding:8px 10px;
      font-size:13px;
      outline:none;
    }
    .country-options{
      max-height:220px;
      overflow:auto;
    }
    .country-option{
      width:100%;
      border:none;
      background:#ffffff;
      padding:6px 10px;
      display:flex;
      align-items:center;
      gap:6px;
      font-size:13px;
      cursor:pointer;
      text-align:left;
    }
    .country-option span{
      pointer-events:none;
    }
    .country-option:hover{
      background:#f3f4f6;
    }

    /* Email suggestions (p√≠ldoras) */
    .email-suggestions{
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      margin-top:3px;
    }
    .email-pill{
      border-radius:999px;
      border:1px solid #d1d5db;
      padding:2px 8px;
      font-size:11px;
      cursor:pointer;
      background:#f9fafb;
      color:#4b5563;
    }
    .email-pill:hover{
      background:#111827;
      color:#ffffff;
      border-color:#111827;
    }

    option[disabled]{ color:#9ca3af; }
  </style>
</head>
<body>
  <main class="shell">
    <div class="inner">
      <!-- Columna izquierda: texto -->
      <section>
        <div class="brand-pill">
          <span class="brand-pill-dot"></span>
          <span class="logo-text">RepairOS ¬∑ by T√©cnicos y Aprendices</span>
        </div>

        <h1>Activa la licencia de tu taller en RepairOS</h1>
        <p class="subtitle">
          Centraliza √≥rdenes, clientes, inventario y finanzas en un solo panel profesional. 
          Registra tu taller, elige tu plan y activamos tu acceso en menos de 24 horas h√°biles.
        </p>

        <div class="steps">
          <div class="step">
            <div class="step-icon">1</div>
            <div>
              <strong>Reg√≠strate con los datos de tu taller.</strong><br>
              Nombre del negocio, responsable y canales de contacto.
            </div>
          </div>
          <div class="step">
            <div class="step-icon">2</div>
            <div>
              <strong>Elige tu plan y medio de pago.</strong><br>
              Registramos tu solicitud y luego te enviamos las instrucciones para completar el pago.
            </div>
          </div>
          <div class="step">
            <div class="step-icon">3</div>
            <div>
              <strong>Activamos tu usuario en RepairOS.</strong><br>
              En m√°ximo <b>24 horas h√°biles</b> despu√©s de validar el pago, recibir√°s tu acceso por correo y WhatsApp.
            </div>
          </div>
        </div>

        <div class="note-box">
          ‚ö†Ô∏è <b>Importante:</b> el acceso se activa de forma manual para validar el pago y configurar tu taller.
          Aseg√∫rate de ingresar correctamente tu correo y n√∫mero de WhatsApp, all√≠ enviaremos toda la informaci√≥n de acceso.
        </div>

        <div class="badge-row">
          <span class="badge">Licencias 1 ¬∑ 6 ¬∑ 12 meses</span>
          <span class="badge-outline">Soporte especializado por WhatsApp</span>
          <span class="badge-outline">Multiusuario y multi-taller</span>
        </div>
      </section>

      <!-- Columna derecha: formulario -->
      <section>
        <div class="card">
          <div class="card-header">
            <div>
              <h2 class="card-title">Registro de nuevo taller</h2>
              <p class="card-desc">
                Completa el formulario para solicitar la activaci√≥n de tu licencia.
              </p>
            </div>
            <div class="pill-small">
              Registro de licencia
            </div>
          </div>

          <form id="signupForm" novalidate>
            <div>
              <div class="section-label">Datos del taller</div>
              <div class="grid">
                <label>
                  Nombre del taller / negocio
                  <input type="text" name="store_name" placeholder="Ej: FixXpert Centro de Reparaciones" required>
                </label>
                <label>
                  Nombre del responsable
                  <input type="text" name="owner_name" placeholder="Nombre y apellido del responsable" required>
                </label>
                <label>
                  Correo electr√≥nico
                  <input type="email" name="email" id="emailMain" placeholder="Correo principal para notificaciones" required>
                  <div class="email-suggestions" id="emailSuggestions" style="display:none;"></div>
                </label>
                <label>
                  WhatsApp de contacto
                  <div class="phone-row">
                    <div class="country-select" id="countrySelect">
                      <button type="button" class="country-select-btn" id="countrySelectBtn">
                        <span class="country-flag" id="countryFlag">üá®üá¥</span>
                        <span class="country-dial" id="countryDial">+57</span>
                        <span class="country-name-short" id="countryShort">Colombia</span>
                      </button>
                      <div class="country-select-dropdown" id="countryDropdown">
                        <input type="text" class="country-search" id="countrySearch" placeholder="Buscar pa√≠s o c√≥digo">
                        <div class="country-options" id="countryOptions"></div>
                      </div>
                    </div>
                    <input type="tel" name="whatsapp_number" id="whatsappNumber" placeholder="3000000000" required>
                    <input type="hidden" name="country_code" id="countryCode" value="+57">
                  </div>
                </label>
                <label>
                  Ciudad / Pa√≠s
                  <input type="text" name="location" placeholder="Ej: Medell√≠n, Colombia">
                </label>
              </div>
            </div>

            <div>
              <div class="section-label">Datos de acceso</div>
              <div class="grid">
                <label>
                  Usuario (correo)
                  <input type="email" name="login_email" id="loginEmail" placeholder="Puedes usar el mismo correo de notificaciones" required>
                  <p class="hint">Recomendado: usar el mismo correo de notificaciones para tu usuario de acceso.</p>
                </label>
                <label>
                  Contrase√±a
                  <div class="password-wrap">
                    <input type="password" name="password" id="passwordInput" minlength="6" placeholder="Crea una contrase√±a segura" required>
                    <button type="button" class="password-toggle" id="togglePass" aria-label="Mostrar u ocultar contrase√±a">üëÅÔ∏è</button>
                  </div>
                </label>
              </div>
            </div>

            <div>
              <div class="section-label">Licencia y pago</div>
              <div class="grid">
                <label>
                  Plan de licencia
                  <select name="license_plan" required>
                    <option value="">Selecciona un plan</option>
                    <option value="PRO_1M">1 mes</option>
                    <option value="PRO_6M">6 meses</option>
                    <option value="PRO_12M">12 meses</option>
                  </select>
                </label>
                <label>
                  Medio de pago
                  <select name="payment_method" id="paymentMethod" required>
                    <option value="EPAYCO" disabled>ePayco (tarjeta, PSE, etc.) ‚Äî temporalmente no disponible</option>
                    <option value="BINANCE">Binance (pago manual)</option>
                    <option value="PAYPAL">PayPal (pago manual)</option>
                    <option value="WU">Western Union (pago manual)</option>
                  </select>
                </label>
              </div>
              <p class="hint">
                Despu√©s de enviar este formulario registraremos tu solicitud. En las pr√≥ximas horas te contactaremos por correo 
                o WhatsApp con las instrucciones para realizar el pago seg√∫n el medio elegido.<br>
                <b>¬øNecesitas un plan especial?</b> Haz tu registro y nuestro equipo se pondr√° en contacto contigo.
              </p>
            </div>

            <div class="footer">
              <label class="terms-check">
                <input type="checkbox" name="accept_terms" id="acceptTermsCheckbox" required>
                <span>
                  Declaro que he le√≠do y acepto el
                  <button type="button" class="link-terms" id="openTermsBtn">
                    tratamiento de datos y el uso de RepairOS bajo licencia
                  </button>.
                </span>
              </label>

              <div class="btn-row">
                <button type="button" class="btn-secondary" onclick="window.location.href='https://yepez8981.github.io/RepairOS/'">Volver</button>
                <button type="submit" class="btn-primary" id="submitBtn">
                  Enviar solicitud
                  <span id="btnSpinner" style="display:none;">‚è≥</span>
                </button>
              </div>
            </div>

            <div id="statusMsg" class="status-msg"></div>
          </form>
        </div>
      </section>
    </div>
  </main>

  <!-- MODAL T√âRMINOS -->
  <div class="terms-overlay" id="termsOverlay">
    <div class="terms-modal" role="dialog" aria-modal="true" aria-labelledby="termsTitle">
      <header class="terms-header">
        <div>
          <h2 id="termsTitle">T√©rminos de uso y tratamiento de datos</h2>
          <p class="terms-subtitle">
            Resumen de c√≥mo usamos tu informaci√≥n y c√≥mo funciona la licencia de RepairOS.
          </p>
        </div>
        <button type="button" class="terms-close" id="closeTermsBtn" aria-label="Cerrar">√ó</button>
      </header>

      <div class="terms-body">
        <section class="terms-block">
          <h3>1. Protecci√≥n y manejo de datos personales</h3>
          <p>
            En <b>T√©cnicos y Aprendices</b> respetamos tu privacidad y el uso responsable de tu informaci√≥n.
            Al registrarte o usar <b>RepairOS</b>, aceptas las siguientes condiciones de uso y pol√≠ticas de protecci√≥n de datos,
            dise√±adas conforme a la legislaci√≥n colombiana y est√°ndares internacionales (GDPR y CCPA).
          </p>
          <p>La informaci√≥n que registras se usa exclusivamente para:</p>
          <ul>
            <li>Crear y administrar tu cuenta.</li>
            <li>Activar tu licencia de RepairOS.</li>
            <li>Brindar soporte t√©cnico o administrativo.</li>
            <li>Enviar notificaciones, recordatorios o comprobantes de pago.</li>
          </ul>
          <p>
            Tus datos se almacenan en servidores seguros y <b>no se comparten con terceros</b> fuera de los procesos
            de pago o requerimientos legales de autoridad competente.
          </p>
          <p>
            Pod√©s solicitar en cualquier momento la actualizaci√≥n, rectificaci√≥n o eliminaci√≥n de tus datos escribiendo a nuestro canal oficial de soporte:<br>
            üì≤ <b>WhatsApp +57 321 917 7941</b>
          </p>
        </section>

        <section class="terms-block">
          <h3>2. Uso de la licencia RepairOS</h3>
          <p>
            La licencia que te otorgamos es <b>personal, exclusiva y no transferible</b>, v√°lida √∫nicamente para el taller
            o negocio registrado en el formulario.
          </p>
          <ul>
            <li>Solo el titular y su equipo autorizado pueden utilizar el acceso.</li>
            <li>Est√° prohibida la reventa, alquiler, pr√©stamo o cesi√≥n de la cuenta a terceros ajenos al negocio.</li>
            <li>El uso indebido de la cuenta puede generar la <b>suspensi√≥n inmediata del acceso sin reembolso</b>.</li>
          </ul>
          <p>
            Cada plan (1, 6 o 12 meses) tiene vigencia limitada y debe renovarse una vez cumplido el periodo contratado.
          </p>
        </section>

        <section class="terms-block">
          <h3>3. Pagos y activaci√≥n</h3>
          <p>
            Los pagos se realizan por <b>pasarelas seguras</b> o medios autorizados (ePayco, PayPal, Binance, Western Union u otros
            medios informados oficialmente). RepairOS <b>no almacena</b> datos de tarjetas de cr√©dito ni informaci√≥n bancaria sensible.
          </p>
          <ul>
            <li>La activaci√≥n del servicio se realiza dentro de las <b>24 horas h√°biles</b> posteriores a la confirmaci√≥n del pago.</li>
            <li>En pagos manuales (Binance, PayPal, WU, etc.) siempre debes confirmar los datos con nuestro soporte oficial antes de enviar dinero.</li>
            <li>T√©cnicos y Aprendices no se hace responsable por pagos enviados a contactos o cuentas no oficiales.</li>
          </ul>
        </section>

        <section class="terms-block">
          <h3>4. Responsabilidad del usuario</h3>
          <ul>
            <li>El usuario es responsable de la veracidad de la informaci√≥n que registra en el sistema.</li>
            <li>El usuario debe proteger sus credenciales y no compartirlas con personas no autorizadas.</li>
            <li>RepairOS se ofrece ‚Äútal cual‚Äù, sin garant√≠a de disponibilidad continua, pudiendo presentar mantenimientos o interrupciones.</li>
            <li>T√©cnicos y Aprendices no se hace responsable por fallas externas, demoras de terceros o p√©rdida de informaci√≥n causada por un mal uso del sistema.</li>
          </ul>
        </section>

        <section class="terms-block">
          <h3>5. Propiedad intelectual</h3>
          <p>
            RepairOS, su dise√±o, logotipo, c√≥digo y materiales asociados son propiedad exclusiva de <b>T√©cnicos y Aprendices</b>.
          </p>
          <ul>
            <li>Est√° prohibido copiar, modificar, descompilar o redistribuir el sistema sin autorizaci√≥n escrita.</li>
            <li>Cualquier uso no autorizado puede dar lugar a acciones legales seg√∫n la normativa vigente.</li>
          </ul>
        </section>

        <section class="terms-block">
          <h3>6. Seguridad de la informaci√≥n</h3>
          <p>
            Implementamos medidas t√©cnicas y organizativas para proteger tus datos, incluyendo cifrado, controles de acceso
            y monitoreo de seguridad.
          </p>
          <ul>
            <li>Trabajamos para mantener altos est√°ndares de seguridad y confidencialidad.</li>
            <li>Aun as√≠, ning√∫n sistema es 100% invulnerable y el usuario tambi√©n debe contribuir usando contrase√±as seguras y √∫nicas.</li>
          </ul>
        </section>

        <section class="terms-block">
          <h3>7. Cumplimiento legal</h3>
          <p>
            Estos t√©rminos se ajustan a la <b>Ley 1581 de 2012</b> (Colombia), al <b>Reglamento GDPR (UE 2016/679)</b>
            y a la <b>California Consumer Privacy Act (CCPA)</b>, en lo que resulte aplicable.
          </p>
          <p>
            El uso de RepairOS implica que has le√≠do y aceptas estas condiciones, as√≠ como nuestras pol√≠ticas de tratamiento
            de datos personales y privacidad.
          </p>
          <p class="terms-note">
            üì≤ <b>Contacto oficial:</b> +57 321 917 7941<br>
          </p>
        </section>
      </div>

      <footer class="terms-footer">
        <button type="button" class="btn-primary" id="acceptTermsBtn">He le√≠do y entiendo estos t√©rminos</button>
      </footer>
    </div>
  </div>

  <script>
  // URL del backend de registro
  const GAS_EXEC = "https://script.google.com/macros/s/AKfycbyVPVYIYgCEM2ZhXg5FseX-sd0bPvPp3O06SQ4d9DCIpyq-pGsFJjEnQREQNrgWH8cF/exec";

  const signupForm    = document.getElementById('signupForm');
  const submitBtn     = document.getElementById('submitBtn');
  const btnSpinner    = document.getElementById('btnSpinner');
  const statusMsg     = document.getElementById('statusMsg');
  const termsCheckbox = document.getElementById('acceptTermsCheckbox');

  const emailMain     = document.getElementById('emailMain');
  const loginEmail    = document.getElementById('loginEmail');
  const emailSuggestions = document.getElementById('emailSuggestions');

  const passwordInput = document.getElementById('passwordInput');
  const togglePass    = document.getElementById('togglePass');

  // country selector elements
  const countrySelectBtn = document.getElementById('countrySelectBtn');
  const countryDropdown  = document.getElementById('countryDropdown');
  const countrySearch    = document.getElementById('countrySearch');
  const countryOptionsEl = document.getElementById('countryOptions');
  const countryFlagEl    = document.getElementById('countryFlag');
  const countryDialEl    = document.getElementById('countryDial');
  const countryShortEl   = document.getElementById('countryShort');
  const countryCodeInput = document.getElementById('countryCode');
  const whatsappNumber   = document.getElementById('whatsappNumber');

  // control de lectura de t√©rminos
  let termsViewedEnough = false;
  let termsTimer = null;
  const MIN_TERMS_MS = 8000; // 8 segundos de "lectura"

  function setLoading(isLoading){
    if(isLoading){
      submitBtn.disabled = true;
      btnSpinner.style.display = 'inline';
    }else{
      submitBtn.disabled = false;
      btnSpinner.style.display = 'none';
    }
  }

  // ===== SUGERENCIAS EMAIL =====
  function updateEmailSuggestions(){
    const value = (emailMain.value || "").trim();
    const atIndex = value.indexOf("@");
    const user = atIndex === -1 ? value : value.slice(0, atIndex);

    if(!user){
      emailSuggestions.style.display = "none";
      emailSuggestions.innerHTML = "";
      return;
    }

    const domains = ["gmail.com","outlook.com","hotmail.com","yahoo.com","icloud.com","protonmail.com","live.com","msn.com","aol.com","yandex.com"];
    emailSuggestions.innerHTML = "";
    domains.forEach(dom => {
      const full = user + "@" + dom;
      const pill = document.createElement("button");
      pill.type = "button";
      pill.className = "email-pill";
      pill.textContent = full;
      pill.addEventListener("click", () => {
        emailMain.value = full;
        emailSuggestions.style.display = "none";
        emailSuggestions.innerHTML = "";
        if(!loginEmail.value){
          loginEmail.value = full;
        }
      });
      emailSuggestions.appendChild(pill);
    });
    emailSuggestions.style.display = "flex";
  }

  emailMain.addEventListener("input", updateEmailSuggestions);
  emailMain.addEventListener("blur", () => {
    setTimeout(() => {
      emailSuggestions.style.display = "none";
    }, 150);
  });

  // Prefill login_email con el principal si est√° vac√≠o
  loginEmail.addEventListener("focus", () => {
    if(!loginEmail.value && emailMain.value){
      loginEmail.value = emailMain.value;
    }
  });

  // ===== LISTA DE PA√çSES CON BANDERAS =====
  const countries = [
    { code:"+57", name:"Colombia", flag:"üá®üá¥" },
    { code:"+52", name:"M√©xico", flag:"üá≤üáΩ" },
    { code:"+54", name:"Argentina", flag:"üá¶üá∑" },
    { code:"+56", name:"Chile", flag:"üá®üá±" },
    { code:"+51", name:"Per√∫", flag:"üáµüá™" },
    { code:"+593", name:"Ecuador", flag:"üá™üá®" },
    { code:"+591", name:"Bolivia", flag:"üáßüá¥" },
    { code:"+598", name:"Uruguay", flag:"üá∫üáæ" },
    { code:"+595", name:"Paraguay", flag:"üáµüáæ" },
    { code:"+58", name:"Venezuela", flag:"üáªüá™" },
    { code:"+55", name:"Brasil", flag:"üáßüá∑" },

    { code:"+1", name:"Estados Unidos", flag:"üá∫üá∏" },
    { code:"+1", name:"Canad√°", flag:"üá®üá¶" },

    { code:"+34", name:"Espa√±a", flag:"üá™üá∏" },
    { code:"+351", name:"Portugal", flag:"üáµüáπ" },
    { code:"+33", name:"Francia", flag:"üá´üá∑" },
    { code:"+39", name:"Italia", flag:"üáÆüáπ" },
    { code:"+49", name:"Alemania", flag:"üá©üá™" },
    { code:"+44", name:"Reino Unido", flag:"üá¨üáß" },
    { code:"+41", name:"Suiza", flag:"üá®üá≠" },
    { code:"+31", name:"Pa√≠ses Bajos", flag:"üá≥üá±" },
    { code:"+32", name:"B√©lgica", flag:"üáßüá™" },
    { code:"+43", name:"Austria", flag:"üá¶üáπ" },
    { code:"+46", name:"Suecia", flag:"üá∏üá™" },
    { code:"+47", name:"Noruega", flag:"üá≥üá¥" },
    { code:"+45", name:"Dinamarca", flag:"üá©üá∞" },
    { code:"+358",name:"Finlandia",flag:"üá´üáÆ"},
    { code:"+353",name:"Irlanda",flag:"üáÆüá™"},
    { code:"+420",name:"Rep√∫blica Checa",flag:"üá®üáø"},
    { code:"+421",name:"Eslovaquia",flag:"üá∏üá∞"},
    { code:"+36",name:"Hungr√≠a",flag:"üá≠üá∫"},
    { code:"+48",name:"Polonia",flag:"üáµüá±"},
    { code:"+40",name:"Rumania",flag:"üá∑üá¥"},
    { code:"+380",name:"Ucrania",flag:"üá∫üá¶"},
    { code:"+7", name:"Rusia",flag:"üá∑üá∫"},
    { code:"+90",name:"Turqu√≠a",flag:"üáπüá∑"},

    { code:"+27",name:"Sud√°frica",flag:"üáøüá¶"},
    { code:"+234",name:"Nigeria",flag:"üá≥üá¨"},
    { code:"+254",name:"Kenia",flag:"üá∞üá™"},
    { code:"+212",name:"Marruecos",flag:"üá≤üá¶"},
    { code:"+20",name:"Egipto",flag:"üá™üá¨"},

    { code:"+971",name:"Emiratos √Årabes Unidos",flag:"üá¶üá™"},
    { code:"+966",name:"Arabia Saudita",flag:"üá∏üá¶"},
    { code:"+974",name:"Qatar",flag:"üá∂üá¶"},
    { code:"+965",name:"Kuwait",flag:"üá∞üáº"},

    { code:"+91",name:"India",flag:"üáÆüá≥"},
    { code:"+880",name:"Banglad√©s",flag:"üáßüá©"},
    { code:"+92",name:"Pakist√°n",flag:"üáµüá∞"},
    { code:"+94",name:"Sri Lanka",flag:"üá±üá∞"},

    { code:"+81",name:"Jap√≥n",flag:"üáØüáµ"},
    { code:"+82",name:"Corea del Sur",flag:"üá∞üá∑"},
    { code:"+86",name:"China",flag:"üá®üá≥"},
    { code:"+886",name:"Taiw√°n",flag:"üáπüáº"},
    { code:"+66",name:"Tailandia",flag:"üáπüá≠"},
    { code:"+84",name:"Vietnam",flag:"üáªüá≥"},
    { code:"+63",name:"Filipinas",flag:"üáµüá≠"},
    { code:"+62",name:"Indonesia",flag:"üáÆüá©"},
    { code:"+60",name:"Malasia",flag:"üá≤üáæ"},
    { code:"+65",name:"Singapur",flag:"üá∏üá¨"},

    { code:"+61",name:"Australia",flag:"üá¶üá∫"},
    { code:"+64",name:"Nueva Zelanda",flag:"üá≥üáø"}
  ];

  function renderCountryOptions(filter=""){
    const q = filter.toLowerCase();
    countryOptionsEl.innerHTML = "";
    countries
      .filter(c => c.name.toLowerCase().includes(q) || c.code.includes(q))
      .forEach(c => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "country-option";
        btn.innerHTML = `<span class="country-flag">${c.flag}</span>
                         <span class="country-dial">${c.code}</span>
                         <span class="country-name-short">${c.name}</span>`;
        btn.addEventListener("click", () => {
          countryFlagEl.textContent  = c.flag;
          countryDialEl.textContent  = c.code;
          countryShortEl.textContent = c.name;
          countryCodeInput.value     = c.code;
          countryDropdown.style.display = "none";
        });
        countryOptionsEl.appendChild(btn);
      });
  }

  countrySelectBtn.addEventListener("click", () => {
    const isOpen = countryDropdown.style.display === "block";
    countryDropdown.style.display = isOpen ? "none" : "block";
    if(!isOpen){
      countrySearch.value = "";
      renderCountryOptions("");
      countrySearch.focus();
    }
  });

  countrySearch.addEventListener("input", (e) => {
    renderCountryOptions(e.target.value);
  });

  document.addEventListener("click", (e) => {
    if(!countryDropdown.contains(e.target) && !countrySelectBtn.contains(e.target)){
      countryDropdown.style.display = "none";
    }
  });

  // valor inicial
  renderCountryOptions("");

  // Toggle contrase√±a
  togglePass.addEventListener("click", () => {
    const isPass = passwordInput.type === "password";
    passwordInput.type = isPass ? "text" : "password";
    togglePass.textContent = isPass ? "üôà" : "üëÅÔ∏è";
  });

  // control de lectura de t√©rminos
  const termsOverlay   = document.getElementById('termsOverlay');
  const openTermsBtn   = document.getElementById('openTermsBtn');
  const closeTermsBtn  = document.getElementById('closeTermsBtn');
  const acceptTermsBtn = document.getElementById('acceptTermsBtn');

  function openTerms(){
    termsOverlay.style.display = 'flex';
    termsViewedEnough = false;
    if(termsTimer) clearTimeout(termsTimer);
    termsTimer = setTimeout(() => {
      termsViewedEnough = true;
    }, MIN_TERMS_MS);
  }
  function closeTerms(){
    termsOverlay.style.display = 'none';
  }

  if(openTermsBtn)   openTermsBtn.addEventListener('click', openTerms);
  if(closeTermsBtn)  closeTermsBtn.addEventListener('click', closeTerms);
  if(acceptTermsBtn) acceptTermsBtn.addEventListener('click', () => {
    termsCheckbox.checked = true;
    closeTerms();
  });

  // env√≠o formulario
  signupForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    statusMsg.textContent = "";
    statusMsg.classList.remove('status-error');

    if(!termsCheckbox.checked){
      alert('Debes aceptar los t√©rminos y condiciones para continuar.');
      return;
    }
    if(!termsViewedEnough){
      alert('Por favor abre y revisa los t√©rminos y condiciones antes de continuar.');
      openTerms();
      return;
    }

    const formData = new FormData(signupForm);
    const data = Object.fromEntries(formData.entries());

    const cc   = data.country_code || "+57";
    const num  = (data.whatsapp_number || "").replace(/\s+/g,"");
    data.whatsapp = cc + num;
    delete data.country_code;
    delete data.whatsapp_number;

    if(!data.login_email) data.login_email = data.email;
    data.accept_terms = data.accept_terms ? "YES" : "NO";

    if(data.payment_method === "EPAYCO"){
      statusMsg.textContent = "ePayco no est√° disponible temporalmente. Selecciona otro medio de pago.";
      statusMsg.classList.add('status-error');
      return;
    }

    const payload = { fn: 'publicSignup', data };

    try{
      setLoading(true);

      const res = await fetch(GAS_EXEC, {
        method:'POST',
        headers:{ 'Content-Type':'text/plain' },
        body: JSON.stringify(payload)
      });

      const out = await res.json();
      setLoading(false);

      if(out.ok){
        statusMsg.textContent =
          "Solicitud registrada correctamente. En las pr√≥ximas horas te contactaremos por correo o WhatsApp con las instrucciones de pago.";
        signupForm.reset();
        termsViewedEnough = false;
      }else{
        statusMsg.textContent = out.message || "No se pudo registrar la solicitud. Intenta nuevamente.";
        statusMsg.classList.add('status-error');
      }
    }catch(err){
      console.error(err);
      setLoading(false);
      statusMsg.textContent = "Error de conexi√≥n. Verifica tu internet e int√©ntalo de nuevo.";
      statusMsg.classList.add('status-error');
    }
  });
  </script>
</body>
</html>
